FROM python:3.9.7-alpine
WORKDIR /code

COPY requirements.txt ./

RUN apk update &&\
    apk add --no-cache --virtual .build-deps \
        build-base \
        gcc &&\
    pip install --user -r requirements.txt &&\
    apk del .build-deps &&\
    rm -rf /root/* /tmp/*

COPY bot.py config.py last_known_id.txt ./

ARG TG_CHANNEL
ENV VAR_TG_CHANNEL=$TG_CHANNEL

ARG TG_BOT_TOKEN
ENV VAR_TG_BOT_TOKEN=$TG_BOT_TOKEN

ARG VK_TOKEN
ENV VAR_VK_TOKEN=$VK_TOKEN

ARG VK_DOMAIN
ENV VAR_VK_DOMAIN=$VK_DOMAIN

ARG TG_LOG_CHANNEL
ENV VAR_TG_LOG_CHANNEL=$TG_LOG_CHANNEL

ARG TG_BOT_LOG_TOKEN
ENV VAR_TG_BOT_LOG_TOKEN=$TG_BOT_LOG_TOKEN

ARG REQ_VERSION
ENV VAR_REQ_VERSION=$REQ_VERSION

ARG REQ_COUNT
ENV VAR_REQ_COUNT=$REQ_COUNT

ARG REQ_FILTER
ENV VAR_REQ_FILTER=$REQ_FILTER

ARG SINGLE_START
ENV VAR_SINGLE_START=$SINGLE_START

ARG TIME_TO_SLEEP
ENV VAR_TIME_TO_SLEEP=$TIME_TO_SLEEP

ARG SKIP_ADS_POSTS
ENV VAR_SKIP_ADS_POSTS=$SKIP_ADS_POSTS

ARG SKIP_COPYRIGHTED_POSTS
ENV VAR_SKIP_COPYRIGHTED_POST=$SKIP_COPYRIGHTED_POSTS

ARG WHITELIST
ENV VAR_WHITELIST=$WHITELIST

ARG BLACKLIST
ENV VAR_BLACKLIST=$BLACKLIST

ARG PROXY_ENABLE
ENV VAR_PROXY_ENABLE=$PROXY_ENABLE

ARG PROXY_LOGIN
ENV VAR_PROXY_LOGIN=$PROXY_LOGIN

ARG PROXY_PASS
ENV VAR_PROXY_PASS=$PROXY_PASS

ARG PROXY_IP
ENV VAR_PROXY_IP=$PROXY_IP

ARG PROXY_PORT
ENV VAR_PROXY_PORT=$PROXY_PORT

ARG LOG_FOLDER_NAME
ENV VAR_LOG_FOLDER_NAME=$LOG_FOLDER_NAME

ARG LOG_FILE_NAME
ENV VAR_LOG_FILE_NAME=$LOG_FILE_NAME

CMD ["./bot.py"]
ENTRYPOINT ["python"]
